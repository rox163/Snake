<html>
  <head>
    <title>Snake</title>
  <script language="JavaScript" src="raphael.js"> </script>
  </head>
  <body onkeydown="moveSnake()">
    <div id="snake"> 
    </div>
    <p id="Code">
	</p>
	  <script language="JavaScript">
	  
		var G_CANVAS_SIZE = 400;
		var G_ANIMATE_TIME = 100;
		var G_SNAKE_SIZE = 10;

		var G_KEY = { right : 39, left : 37, up : 38, down : 40};

		var gKey;
		var gGameStarted = false;

		var paper = Raphael(document.getElementById("snake"), G_CANVAS_SIZE+1, G_CANVAS_SIZE+1);
		var border = paper.rect(0, 0, G_CANVAS_SIZE,  G_CANVAS_SIZE);
		border.attr("stroke", "#000");

		/*Initialise snake*/
		var superSnake = [];

		superSnake.push({coord : {x : 0, y : G_CANVAS_SIZE - G_SNAKE_SIZE}}, 
			{coord : {x : G_SNAKE_SIZE, y : G_CANVAS_SIZE - G_SNAKE_SIZE}},
			{coord : {x : G_SNAKE_SIZE * 2, y : G_CANVAS_SIZE - G_SNAKE_SIZE}});

		for (var count = 0;count < superSnake.length; count++)
		{
			superSnake[count].snake = paper.rect(superSnake[count].coord.x, superSnake[count].coord.y, G_SNAKE_SIZE, G_SNAKE_SIZE)
				.attr("fill", "#000")
				.attr("stroke", "#000");
		}

		/*Place a random block on the canvas*/
		generateBlock();
		
		
		function generateBlock()
		{	
			var randomLocation = { 
				coord : { 
					x : (Math.round((Math.floor(Math.random()*(G_CANVAS_SIZE-G_SNAKE_SIZE + 1)))/G_SNAKE_SIZE))*G_SNAKE_SIZE,
					y : (Math.round((Math.floor(Math.random()*(G_CANVAS_SIZE-G_SNAKE_SIZE + 1)))/G_SNAKE_SIZE))*G_SNAKE_SIZE 
				}
			};
			
			randomLocation.block = paper.rect(randomLocation.coord.x, randomLocation.coord.y, G_SNAKE_SIZE, G_SNAKE_SIZE)
				.attr("fill", "#000")
				.attr("stroke", "#000");
		}
		
		/*Move snake */
		function moveSnake()
		{			
			key = event.keyCode;
			//document.getElementById("Code").innerHTML = superSnake[i].direction;
			
			if (key == G_KEY.right || key == G_KEY.left || key == G_KEY.up || key == G_KEY.down) //Detecting a change in direction
			{
				gKey = key;
				if (!gGameStarted)
				{
					gGameStarted = true;
					moveBody();
				}	
			}
		}

		function moveBody()
		{
			var i = 0;	
			while (i < superSnake.length-1)
			{					
				superSnake[i].coord.y = superSnake[i + 1].coord.y;
				superSnake[i].coord.x = superSnake[i + 1].coord.x;
				
				superSnake[i].snake.animate({x:superSnake[i].coord.x,y: superSnake[i].coord.y}, G_ANIMATE_TIME);
										
				i++;
			}
			moveHead();
		}
		
		
		function moveHead()
		{
			var headIndex = superSnake.length - 1;
			if (gKey == G_KEY.right)		//Right
			{
				superSnake[headIndex].coord.x = superSnake[headIndex].coord.x + G_SNAKE_SIZE;
				superSnake[headIndex].snake.animate({x: superSnake[headIndex].coord.x}, G_ANIMATE_TIME, function() {
					if (superSnake[headIndex].coord.x < (G_CANVAS_SIZE - G_SNAKE_SIZE))
					{
						moveBody();
					}
				});
			}
			else if (gKey == G_KEY.up)		//Up
			{
				superSnake[headIndex].coord.y = superSnake[headIndex].coord.y - G_SNAKE_SIZE;
				superSnake[headIndex].snake.animate({y: superSnake[headIndex].coord.y}, G_ANIMATE_TIME, function() {
					if ( superSnake[headIndex].coord.y >= G_SNAKE_SIZE)
					{
						moveBody();
					}
				});
			}
			else if (gKey == G_KEY.left)		//Left
			{
				superSnake[headIndex].coord.x = superSnake[headIndex].coord.x - G_SNAKE_SIZE;
				superSnake[headIndex].snake.animate({x: superSnake[headIndex].coord.x}, G_ANIMATE_TIME, function() {
					if (superSnake[headIndex].coord.x > 0)
					{
						moveBody();
					}
				});
			}
			else if (gKey == G_KEY.down)		//Down
			{
				superSnake[headIndex].coord.y = superSnake[headIndex].coord.y + G_SNAKE_SIZE;
				superSnake[headIndex].snake.animate({y: superSnake[headIndex].coord.y}, G_ANIMATE_TIME, function() {
					if (superSnake[headIndex].coord.y < (G_CANVAS_SIZE - G_SNAKE_SIZE))
					{
						moveBody();
					}
				});
			}
		}

	  </script>
  </body>
</html>